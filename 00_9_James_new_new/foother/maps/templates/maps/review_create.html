{% extends 'base.html' %}
{% load bootstrap4 %}

{% block content %}

<h1>Chuck 1</h1>

<label for="addressSearch">ì£¼ì†Œ ê²€ìƒ‰ : <input id="addressSearch" type="text"></label>
<input id="searchBtn" type="submit">
<hr>
<div id="map" style="width:500px;height:400px;"></div>

<form action="{% url 'maps:create' %}" method="POST" enctype="multipart/form-data">
  {% csrf_token %}
  {% bootstrap_form form %}
  <button class="btn btn-success">ì „ì†¡</button>
</form>
<hr>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>

// ê²€ìƒ‰ì„ ìœ„í•œ ë” ê°ì²´ ìƒì„±
var addressSearch = document.getElementById('addressSearch')
var searchBtn = document.getElementById('searchBtn')

var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
              mapOption = {
                  
                  center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                  //center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                  level: 4 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
              };

          // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
          var map = new kakao.maps.Map(mapContainer, mapOption); 


// ì£¼ì†Œê²€ìƒ‰ ë²„íŠ¼ í´ë¦­
searchBtn.addEventListener('click', function(event){
    axios.get('https://dapi.kakao.com/v2/local/search/keyword.json?y=37.514322572335935&x=127.06283102249932&radius=20000',
    { params: {
        query: addressSearch.value,
        category_group_code: 'FD6',
        page:10
      },
    headers: {
      'Authorization': 'KakaoAK 1bdcfbeb6bb8e3bf27b8caf11c8e53b4'
    }
    }).then(function(res){

      // ìš”ì²­ì´ ì„±ê³µí–ˆì„ ë•Œ ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
      // resì— ê°€ê²Œì´ë¦„, ì¢Œí‘œ, ì£¼ì†Œ í¬í•¨ Json ë°ì´í„°ë¡œ ë°›ì•„ì˜´.

      //ì¤‘ì‹¬ì¢Œí‘œë¥¼ ìœ„í•œ ìœ„ë„, ê²½ë„ ì„¤ì •
      var lat = res.data.documents[0].x
      var lng = res.data.documents[0].y
        console.log(res.data)
          // ì§€ë„ ë° ë§ˆì»¤ ì˜ì—­
          // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì„ í‘œì¶œí•  ì¸í¬ìœˆë„ìš° ì…ë‹ˆë‹¤
          var infowindow = new kakao.maps.InfoWindow({zIndex:1});

          var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
              mapOption = {
                  
                  center: new kakao.maps.LatLng(lng, lat), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                  //center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                  level: 4 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
              };

          // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
          var map = new kakao.maps.Map(mapContainer, mapOption); 

          // ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
          var ps = new kakao.maps.services.Places(); 

          // í‚¤ì›Œë“œë¡œ ì¥ì†Œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤
          ps.keywordSearch(addressSearch.value, placesSearchCB);

          // í‚¤ì›Œë“œ ê²€ìƒ‰ ì™„ë£Œ ì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜ ì…ë‹ˆë‹¤
          function placesSearchCB (data, status, pagination) {
              if (status === kakao.maps.services.Status.OK) {
                
                  // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•˜ê¸°ìœ„í•´
                  // LatLngBounds ê°ì²´ì— ì¢Œí‘œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
                  var bounds = new kakao.maps.LatLngBounds();

                  for (var i=0; i<data.length; i++) {
                      displayMarker(data[i]);    
                      bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
                  }       
                  // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤
                  map.setBounds(bounds);
              } 
          }

          // ì§€ë„ì— ë§ˆì»¤ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
            function displayMarker(place) {
                console.log("hhhhh")
                // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: new kakao.maps.LatLng(place.y, place.x) 
                });

                // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                kakao.maps.event.addListener(marker, 'click', function() {
                    // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì´ ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë©ë‹ˆë‹¤
                    infowindow.setContent('<div style="padding:5px;font-size:12px;"><ol>' +
                    '<li><h6> ìŒì‹ì  ì´ë¦„: ' + place.place_name + '</h6></li>'+
                    '<li><h6> ì¹´í…Œê³ ë¦¬: ' + place.category_name + '</h6></li>'+
                    '<li><h6> ìƒì„¸ì£¼ì†Œ: ' + place.road_address_name + '</h6></li>'+
                    '<li><h6> ì „í™”ë²ˆí˜¸: ' + place.phone + '</h6></li>'+
                    '</ol></div>');
                    infowindow.open(map, marker);

                     // ë¦¬ë·°ë¡œ ì˜¬ë¦´ ìœ„ë„ ì„¤ì •
                      var lat = document.querySelector('#id_lat')
                      lat.value = place.y;

                      // ë¦¬ë·°ë¡œ ì˜¬ë¦´ ê²½ë„ ì„¤ì •
                      var lng = document.querySelector('#id_lng')
                      lng.value = place.x;

                      //ë¦¬ë·°ë¡œ ì˜¬ë¦´ ìŒì‹ì  ì´ë¦„ ì„¤ì •
                      var restaurant_name = document.querySelector('#id_restaurant_name')
                      restaurant_name.value = place.place_name

                      //ë¦¬ë·°ë¡œ ì˜¬ë¦´ ìŒì‹ì  ì£¼ì†Œ ì„¤ì •
                      var restaurant_address = document.querySelector('#id_restaurant_address')
                      restaurant_address.value = place.road_address_name
                });
            }
                }).catch(
                  alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.ğŸ¥µ")
                )
})
{% comment %} 
  //ë¦¬ë·°ë¡œ ì˜¬ë¦´ ìŒì‹ ì´ë¦„ ì„¤ì •
  var restaurant_name = document.querySelector('#id_restaurant_name')
  restaurant_name.addEventListener('change', function(event){}
  
  
  //ë¦¬ë·°ë¡œ ì˜¬ë¦´ ìŒì‹ì  ë³„ì  ì„¤ì •
  var food_star = document.querySelector('#id_food_star')
  food_star.addEventListener('change', function(event){}

  //ë¦¬ë·°ë¡œ ì˜¬ë¦´ ìŒì‹ì  ë¦¬ë·° ì„¤ì •
  var food_review = document.querySelector('#id_food_review')
  food_review.addEventListener('change', function(event){}

  //ë¦¬ë·°ë¡œ ì˜¬ë¦´ ìŒì‹ì  ì‚¬ì§„ ì„¤ì •
  var food_image = document.querySelector('#id_food_image')
  food_image.addEventListener('change', function(event){} {% endcomment %}


</script>


<hr>
      <div class="container" data-aos="fade-up">

        <div class="section-title">
          <h2>Facts</h2>
          <p>Magnam dolores commodi suscipit. Necessitatibus eius consequatur ex aliquid fuga eum quidem. Sit sint consectetur velit. Quisquam quos quisquam cupiditate. Et nemo qui impedit suscipit alias ea. Quia fugiat sit in iste officiis commodi quidem hic quas.</p>
        </div>

        <div class="row">

          <div class="col-lg-3 col-md-6">
            <div class="count-box">
              <i class="icofont-simple-smile"></i>
              <span data-toggle="counter-up">232</span>
              <p>Happy Clients</p>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 mt-5 mt-md-0">
            <div class="count-box">
              <i class="icofont-document-folder"></i>
              <span data-toggle="counter-up">521</span>
              <p>Projects</p>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 mt-5 mt-lg-0">
            <div class="count-box">
              <i class="icofont-live-support"></i>
              <span data-toggle="counter-up">1,463</span>
              <p>Hours Of Support</p>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 mt-5 mt-lg-0">
            <div class="count-box">
              <i class="icofont-users-alt-5"></i>
              <span data-toggle="counter-up">15</span>
              <p>Hard Workers</p>
            </div>
          </div>

        </div>

      </div>
    
{% endblock %}
